var NativeDocument=function(t){"use strict";let n={};n={log(){},warn(){},error(){},disable(){}};var r=n;const o=function(){let e=0;const t=new Map;return{register(n){const r=++e;return t.set(r,new WeakRef(n)),r},unregister(e){t.delete(e)},getObservableById:e=>t.get(e)?.deref(),cleanup(){for(const[e,n]of t){const e=n.deref();e&&e.cleanup()}t.clear()},cleanObservables(e){if(t.size<e)return;let n=0;for(const[e,r]of t)r.deref()||(t.delete(e),n++);n>0&&r.log("Memory Auto Clean",`🧹 Cleaned ${n} orphaned observables`)}}}();class s extends Error{constructor(e,t={}){super(e),this.name="NativeDocumentError",this.context=t,this.timestamp=(new Date).toISOString()}}function i(e,t){this.observable=e,this.checker=t,this.unSubscriptions=[]}i.prototype.__$isObservableChecker=!0,i.prototype.subscribe=function(e){const t=this.observable.subscribe(t=>{e&&e(this.checker(t))});return this.unSubscriptions.push(t),t},i.prototype.check=function(e){return this.observable.check(()=>e(this.val()))},i.prototype.val=function(){return this.checker&&this.checker(this.observable.val())},i.prototype.set=function(e){return this.observable.set(e)},i.prototype.trigger=function(){return this.observable.trigger()},i.prototype.cleanup=function(){return this.observable.cleanup()};const a=function(){const e=new Map,t=new Map;return{list:()=>t,add(n,r){if(!r||"object"!=typeof r)throw new Error(`Plugin ${n} must be an object`);if(!e.has(n)){r.$name=n,e.set(n,r),"function"==typeof r?.init&&r.init();for(const e in r)/^on[A-Z]/.test(e)&&(t.has(e)||t.set(e,new Set),t.get(e).add(r))}},remove(n){if(!e.has(n))return;const r=e.get(n);"function"==typeof r.cleanup&&r.cleanup();for(const[e,n]of t.entries())n.has(r)&&n.delete(r),0===n.size&&t.delete(e);e.delete(n)},emit(e,...n){const o="on"+e;if(!t.has(o))return;const s=t.get(o);for(const e of s){const t=e[o];if("function"==typeof t)try{t.call(e,...n)}catch(t){r.error("Plugin Manager",`Error in plugin ${e.$name} for event ${o}`,t)}}}}}();function u(e){this.$previousValue=e,this.$currentValue=e,this.$isCleanedUp=!1,this.$listeners=null,this.$watchers=null,this.$memoryId=null,a.emit("CreateObservable",this)}Object.defineProperty(u.prototype,"$value",{get(){return this.$currentValue},set(e){this.set(e)},configurable:!0}),u.prototype.__$isObservable=!0;const l=function(){};u.prototype.triggerListeners=function(e){const t=this.$listeners,n=this.$previousValue,r=this.$currentValue;if(e=e||{},t?.length)for(let o=0,s=t.length;o<s;o++)t[o](r,n,e)},u.prototype.triggerWatchers=function(){if(!this.$watchers)return;const e=this.$watchers,t=this.$previousValue,n=this.$currentValue;e.has(n)&&e.get(n).forEach(e=>{e.set?e.set(!0):e(!0)}),e.has(t)&&e.get(t).forEach(e=>{e.set?e.set(!1):e(!1)})},u.prototype.triggerAll=function(e){this.triggerListeners(e),this.triggerWatchers()},u.prototype.assocTrigger=function(){this.$watchers?.size&&this.$listeners?.length?this.trigger=this.triggerAll:this.$listeners?.length?this.trigger=this.triggerListeners:this.$watchers?.size?this.trigger=this.triggerWatchers:this.trigger=l},u.prototype.trigger=l,u.prototype.set=function(e){const t="function"==typeof e?e(this.$currentValue):e;this.$currentValue!==t&&(this.$previousValue=this.$currentValue,this.$currentValue=t,a.emit("ObservableBeforeChange",this),this.trigger(),a.emit("ObservableAfterChange",this))},u.prototype.val=function(){return this.$currentValue},u.prototype.disconnectAll=function(){if(this.$listeners?.splice(0),this.$previousValue=null,this.$currentValue=null,this.$watchers)for(const[e,t]of this.$watchers)t.splice(0);this.$watchers?.clear(),this.$listeners=null,this.$watchers=null,this.trigger=l},u.prototype.cleanup=function(){o.unregister(this.$memoryId),this.disconnectAll(),this.$isCleanedUp=!0,delete this.$value},u.prototype.subscribe=function(e,t=null){if(this.$listeners=this.$listeners??[],this.$isCleanedUp)return r.warn("Observable subscription","⚠️ Attempted to subscribe to a cleaned up observable."),()=>{};if("function"!=typeof e)throw new s("Callback must be a function");return this.$listeners.push(e),this.assocTrigger(),a.emit("ObservableSubscribe",this,t),()=>{this.unsubscribe(e),this.assocTrigger(),a.emit("ObservableUnsubscribe",this)}},u.prototype.on=function(e,t){this.$watchers=this.$watchers??new Map;let n=this.$watchers.get(e);return n||(n=[],this.$watchers.set(e,n)),n.push(t),this.assocTrigger(),()=>{const r=n.indexOf(t);n?.splice(r,1),0===n.size&&(this.$watchers?.delete(e),n=null),this.assocTrigger()}},u.prototype.unsubscribe=function(e){const t=this.$listeners.indexOf(e);t>-1&&this.$listeners.splice(t,1),this.assocTrigger()},u.prototype.check=function(e){return new i(this,e)},u.prototype.get=u.prototype.check,u.prototype.when=function(e){return{$target:e,$observer:this}},u.prototype.toString=function(){return this.$memoryId||o.register(this),"{{#ObItem::("+this.$memoryId+")}}"};const c=(e,t,n)=>{if(m.isFunction(n))return n(e,t);if(m.isObservable(e)){const r=e.val();return r&&n?r[n]:t}return m.isObject(e)?e[n]??t:e},h=function(e,t){return e.replace(new RegExp(`^[${t}]+|[${t}]+$`,"g"),"")},d={mounted:new WeakMap,mountedSupposedSize:0,unmounted:new WeakMap,unmountedSupposedSize:0,observer:null,checkMutation:function(e){for(const t of e){if(d.mountedSupposedSize>0)for(const e of t.addedNodes){const t=d.mounted.get(e);t&&(t.inDom=!0,t.mounted&&t.mounted(e))}if(d.unmountedSupposedSize>0)for(const e of t.removedNodes){const t=d.unmounted.get(e);t&&(t.inDom=!1,t.unmounted&&!0===t.unmounted(e)&&(t.disconnect(),e.nd?.remove()))}}},watch:function(e,t=!1){let n={inDom:t,mounted:null,unmounted:null,disconnect:()=>{d.mounted.delete(e),d.unmounted.delete(e),d.mountedSupposedSize--,d.unmountedSupposedSize--,n=null}};return{disconnect:n.disconnect,mounted:t=>{n.mounted=t,d.mounted.set(e,n),d.mountedSupposedSize++},unmounted:t=>{n.unmounted=t,d.unmounted.set(e,n),d.unmountedSupposedSize++}}}};d.observer=new MutationObserver(d.checkMutation),d.observer.observe(document.body,{childList:!0,subtree:!0});const p=["Click","DblClick","MouseDown","MouseEnter","MouseLeave","MouseMove","MouseOut","MouseOver","MouseUp","Wheel","KeyDown","KeyPress","KeyUp","Blur","Change","Focus","Input","Invalid","Reset","Search","Select","Submit","Drag","DragEnd","DragEnter","DragLeave","DragOver","DragStart","Drop","AfterPrint","BeforePrint","BeforeUnload","Error","HashChange","Load","Offline","Online","PageHide","PageShow","Resize","Scroll","Unload","Abort","CanPlay","CanPlayThrough","DurationChange","Emptied","Ended","LoadedData","LoadedMetadata","LoadStart","Pause","Play","Playing","Progress","RateChange","Seeked","Seeking","Stalled","Suspend","TimeUpdate","VolumeChange","Waiting","TouchCancel","TouchEnd","TouchMove","TouchStart","AnimationEnd","AnimationIteration","AnimationStart","TransitionEnd","Copy","Cut","Paste","FocusIn","FocusOut","ContextMenu"];function f(e){this.$element=e,this.$observer=null,a.emit("NDElementCreated",e,this)}f.prototype.__$isNDElement=!0;for(const e of p){const t=e.toLowerCase();f.prototype["on"+e]=function(e){return this.$element.addEventListener(t,e),this},f.prototype["onPrevent"+e]=function(e){return this.$element.addEventListener(t,function(t){t.preventDefault(),e&&e(t)}),this},f.prototype["onStop"+e]=function(e){return this.$element.addEventListener(t,function(t){t.stopPropagation(),e&&e(t)}),this},f.prototype["onPreventStop"+e]=function(e){return this.$element.addEventListener(t,function(t){t.stopPropagation(),t.preventDefault(),e&&e(t)}),this}}f.prototype.ref=function(e,t){return e[t]=this.$element,this},f.prototype.unmountChildren=function(){let e=this.$element;for(let t=0,n=e.children.length;t<n;t++){let n=e.children[t];n.$ndProx||n.nd?.remove(),n=null}return e=null,this},f.prototype.remove=function(){let e=this.$element;return e.nd.unmountChildren(),e.$ndProx=null,delete e.nd?.on?.prevent,delete e.nd?.on,delete e.nd,e=null,this},f.prototype.lifecycle=function(e){return this.$observer=this.$observer||d.watch(this.$element),e.mounted&&this.$observer.mounted(e.mounted),e.unmounted&&this.$observer.unmounted(e.unmounted),this},f.prototype.mounted=function(e){return this.lifecycle({mounted:e})},f.prototype.unmounted=function(e){return this.lifecycle({unmounted:e})},f.prototype.htmlElement=function(){return this.$element},f.prototype.node=f.prototype.htmlElement;const m={isObservable:e=>e instanceof u||e instanceof i||e?.__$isObservable,isProxy:e=>e?.__isProxy__,isObservableChecker:e=>e instanceof i||e?.__$isObservableChecker,isArray:e=>Array.isArray(e),isString:e=>"string"==typeof e,isNumber:e=>"number"==typeof e,isBoolean:e=>"boolean"==typeof e,isFunction:e=>"function"==typeof e,isAsyncFunction:e=>"function"==typeof e&&"AsyncFunction"===e.constructor.name,isObject:e=>"object"==typeof e,isJson:e=>"object"==typeof e&&null!==e&&"Object"===e.constructor.name&&!Array.isArray(e),isElement:e=>e instanceof HTMLElement||e instanceof DocumentFragment||e instanceof Text,isFragment:e=>e instanceof DocumentFragment,isStringOrObservable(e){return this.isString(e)||this.isObservable(e)},isValidChild(e){return null===e||this.isElement(e)||this.isObservable(e)||this.isNDElement(e)||["string","number","boolean"].includes(typeof e)},isNDElement:e=>e instanceof f||e?.constructor?.__$isNDElement,isValidChildren(e){Array.isArray(e)||(e=[e]);return 0===e.filter(e=>!this.isValidChild(e)).length},validateChildren(e){Array.isArray(e)||(e=[e]);const t=e.filter(e=>!this.isValidChild(e));if(t.length>0)throw new s(`Invalid children detected: ${t.map(e=>typeof e).join(", ")}`);return e},containsObservables:e=>!!e&&(m.isObject(e)&&Object.values(e).some(e=>m.isObservable(e))),containsObservableReference:e=>!(!e||"string"!=typeof e)&&/\{\{#ObItem::\([0-9]+\)\}\}/.test(e),validateAttributes(e){if(!e||"object"!=typeof e)return e;const t=[],n=Object.keys(e).filter(e=>t.includes(e));return n.length>0&&r.warn("Validator",`Reserved attributes found: ${n.join(", ")}`),e},validateEventCallback(e){if("function"!=typeof e)throw new s("Event callback must be a function")}};function b(e){const t=document.createDocumentFragment(),n=document.createComment("Anchor Start : "+e),o=document.createComment("/ Anchor End "+e);t.appendChild(n),t.appendChild(o),t.nativeInsertBefore=t.insertBefore,t.nativeAppendChild=t.appendChild;const s=function(e,n,r){e!==t?e.insertBefore(E.getChild(n),r):e.nativeInsertBefore(E.getChild(n),r)};return t.appendElement=function(e,n=null){o.parentNode!==t?o.parentNode?.insertBefore(e,n||o):o.parentNode.nativeInsertBefore(e,n||o)},t.appendChild=function(e,n=null){const i=o.parentNode;if(i){if(n=n??o,m.isArray(e)){const r=document.createDocumentFragment();for(let t=0,n=e.length;t<n;t++)r.appendChild(E.getChild(e[t]));return s(i,r,n),t}s(i,e,n)}else r.error("Anchor","Anchor : parent not found",e)},t.removeChildren=function(){const e=o.parentNode;if(e===t)return;if(e.firstChild===n&&e.lastChild===o)return void e.replaceChildren(n,o);let r,s=n.nextSibling;const i=document.createDocumentFragment();for(;s&&s!==o;)r=s.nextSibling,i.append(s),s=r;i.replaceChildren()},t.remove=function(){if(o.parentNode===t)return;let e,r=n.nextSibling;for(;r!==o;)e=r.nextSibling,t.nativeAppendChild(r),r=e},t.removeWithAnchors=function(){t.removeChildren(),n.remove(),o.remove()},t.replaceContent=function(e){const r=o.parentNode;r&&(r.firstChild!==n||r.lastChild!==o?(t.removeChildren(),r.insertBefore(e,o)):r.replaceChildren(n,e,o))},t.insertBefore=function(e,n=null){t.appendChild(e,n)},t.clear=function(){t.remove()},t.endElement=function(){return o},t.startElement=function(){return n},t}const g=["checked","selected","disabled","readonly","required","autofocus","multiple","autocomplete","hidden","contenteditable","spellcheck","translate","draggable","async","defer","autoplay","controls","loop","muted","download","reversed","open","default","formnovalidate","novalidate","scoped","itemscope","allowfullscreen","allowpaymentrequest","playsinline"];function v(e){return new u(e)}function y(e,t){for(let n in t){const r=t[n];m.isObservable(r)?(e.classList.toggle(n,r.val()),r.subscribe(t=>e.classList.toggle(n,t))):r.$observer?(e.classList.toggle(n,r.$observer.val()===r.$target),r.$observer.on(r.$target,function(t){e.classList.toggle(n,t)})):e.classList.toggle(n,r)}}function w(e,t){for(let n in t){const r=t[n];m.isObservable(r)?(e.style[n]=r.val(),r.subscribe(t=>{e.style[n]=t})):e.style[n]=r}}function $(e,t,n){const r=m.isObservable(n)?n.val():n;m.isBoolean(r)?e[t]=r:e[t]=r===e.value,m.isObservable(n)&&(["checked"].includes(t)&&e.addEventListener("input",()=>{m.isBoolean(r)?n.set(e[t]):n.set(e.value)}),n.subscribe(n=>{m.isBoolean(n)?e[t]=n:e[t]=n===e.value}))}function C(e,t,n){const r=n=>{"value"!==t?e.setAttribute(t,n):e.value=n};r(n.val()),n.subscribe(r),"value"===t&&e.addEventListener("input",()=>n.set(e.value))}v.getById=function(e){const t=o.getObservableById(parseInt(e));if(!t)throw new s("Observable.getById : No observable found with id "+e);return t},v.cleanup=function(e){e.cleanup()},v.autoCleanup=function(e=!1,t={}){if(!e)return;const{interval:n=6e4,threshold:r=100}=t;window.addEventListener("beforeunload",()=>{o.cleanup()}),setInterval(()=>o.cleanObservables(r),n)};const O=new Map;let S=null;const E={createTextNode:()=>(S||(S=document.createTextNode("")),S.cloneNode()),createObservableNode(e,t){const n=E.createTextNode();return t.subscribe(e=>n.nodeValue=String(e)),n.nodeValue=t.val(),e&&e.appendChild(n),n},createStaticTextNode(e,t){let n=E.createTextNode();return n.nodeValue=String(t),e&&e.appendChild(n),n},createElement(e){if(e){if(O.has(e))return O.get(e).cloneNode();const t=document.createElement(e);return O.set(e,t),t.cloneNode()}return new b("Fragment")},processChildren(e,t){if(null===e)return;const n=Array.isArray(e)?e:[e];a.emit("BeforeProcessChildren",t);for(let e=0,r=n.length;e<r;e++){let r=this.getChild(n[e]);null!==r&&t.appendChild(r)}a.emit("AfterProcessChildren",t)},getChild(e){if(null===e)return null;if(m.isString(e)&&(e=e.resolveObservableTemplate?e.resolveObservableTemplate():e,m.isString(e)))return E.createStaticTextNode(null,e);if(m.isElement(e))return e;if(m.isObservable(e))return E.createObservableNode(null,e);if(m.isNDElement(e))return e.$element??e.$build?.()??null;if(m.isArray(e)){const t=document.createDocumentFragment();for(let n=0,r=e.length;n<r;n++)t.appendChild(this.getChild(e[n]));return t}return m.isFunction(e)?(a.emit("BeforeProcessComponent",e),this.getChild(e())):E.createStaticTextNode(null,e)},processAttributes(e,t){m.isFragment(e)||t&&function(e,t){if(m.validateAttributes(t),!m.isObject(t))throw new s("Attributes must be an object");for(let n in t){const r=n.toLowerCase();let o=t[r];if(m.isString(o)){if(o=o.resolveObservableTemplate?o.resolveObservableTemplate():o,m.isString(o)){e.setAttribute(r,o);continue}const t=o.filter(e=>m.isObservable(e));o=v.computed(()=>o.map(e=>m.isObservable(e)?e.val():e).join(" ")||" ",t)}"class"===r&&m.isJson(o)?y(e,o):"style"===r&&m.isJson(o)?w(e,o):g.includes(r)?$(e,r,o):m.isObservable(o)?C(e,r,o):e.setAttribute(r,o)}}(e,t)},setup:(e,t,n)=>(a.emit("Setup",e,t,n),e)};function A(e,t){const n=e.toLowerCase();return function(e,o=null){try{if(!m.isJson(e)){const t=o;o=e,e=t}const r=E.createElement(n),s="function"==typeof t?t(r):r;return E.processAttributes(s,e),E.processChildren(o,s),E.setup(s,e,t)}catch(e){r.error("ElementCreation",`Error creating ${n}`,e)}}}Object.defineProperty(HTMLElement.prototype,"nd",{configurable:!0,get(){return this.$nd||(this.$nd=new f(this),this.$nd.nd=this.$nd),this.$nd}});class k extends Error{constructor(e,t){super(`${e}\n\n${t.join("\n")}\n\n`)}}const I={string:e=>({name:e,type:"string",validate:e=>m.isString(e)}),number:e=>({name:e,type:"number",validate:e=>m.isNumber(e)}),boolean:e=>({name:e,type:"boolean",validate:e=>m.isBoolean(e)}),observable:e=>({name:e,type:"observable",validate:e=>m.isObservable(e)}),element:e=>({name:e,type:"element",validate:e=>m.isElement(e)}),function:e=>({name:e,type:"function",validate:e=>m.isFunction(e)}),object:e=>({name:e,type:"object",validate:e=>m.isObject(e)}),objectNotNull:e=>({name:e,type:"object",validate:e=>m.isObject(e)&&null!==e}),children:e=>({name:e,type:"children",validate:e=>m.validateChildren(e)}),attributes:e=>({name:e,type:"attributes",validate:e=>m.validateAttributes(e)}),optional:e=>({...e,optional:!0}),oneOf:(e,...t)=>({name:e,type:"oneOf",types:t,validate:e=>t.some(t=>t.validate(e))})},x=(e,t,n="Function")=>{if(!m.isArray(t))throw new s("withValidation : argSchema must be an array");return function(...r){return((e,t,n="Function")=>{if(!t)return;const r=[],o=t.filter(e=>!e.optional).length;if(e.length<o&&r.push(`${n}: Expected at least ${o} arguments, got ${e.length}`),t.forEach((t,o)=>{const s=o+1,i=e[o];if(void 0!==i){if(!t.validate(i)){const e=i?.constructor?.name||typeof i;r.push(`${n}: Invalid argument '${t.name}' at position ${s}, expected ${t.type}, got ${e}`)}}else t.optional||r.push(`${n}: Missing required argument '${t.name}' at position ${s}`)}),r.length>0)throw new k("Argument validation failed",r)})(r,t,e.name||n),e.apply(this,r)}};Function.prototype.args=function(...e){return x(this,e)},Function.prototype.errorBoundary=function(e){return(...t)=>{try{return this.apply(this,t)}catch(t){return e(t)}}},String.prototype.use=function(e){const t=this;return v.computed(()=>t.replace(/\$\{(.*?)}/g,(t,n)=>{const r=e[n];return m.isObservable(r)?r.val():r}),Object.values(e))},String.prototype.resolveObservableTemplate=function(){return m.containsObservableReference(this)?this.split(/(\{\{#ObItem::\([0-9]+\)\}\})/g).filter(Boolean).map(e=>{if(!m.containsObservableReference(e))return e;const[t,n]=e.match(/\{\{#ObItem::\(([0-9]+)\)\}\}/);return v.getById(n)}):this.valueOf()};const F=["push","pop","shift","unshift","reverse","sort","splice"];v.array=function(e){if(!Array.isArray(e))throw new s("Observable.array : target must be an array");const t=v(e);a.emit("CreateObservableArray",t),F.forEach(e=>{t[e]=function(...n){const r=t.val()[e](...n);return t.trigger({action:e,args:n,result:r}),r}}),t.clear=function(){return t.val().length=0,t.trigger({action:"clear"}),!0},t.merge=function(e){t.set([...t.val(),...e])},t.populateAndRender=function(e,n){t.trigger({action:"populate",args:[t.val(),e,n]})},t.remove=function(e){const n=t.val().splice(e,1);return 0===n.length?[]:(t.trigger({action:"remove",args:[e],result:n[0]}),n)},t.swap=function(e,n){const r=t.val(),o=r.length;if(o<e||o<n)return!1;if(n<e){const t=e;e=n,n=t}const s=r[e],i=r[n];return r[e]=i,r[n]=s,t.trigger({action:"swap",args:[e,n],result:[s,i]}),!0},t.length=function(){return t.val().length};return["map","filter","reduce","some","every","find","findIndex","concat"].forEach(e=>{t[e]=function(...n){return t.val()[e](...n)}}),t},v.batch=function(e){const t=v(0),n=function(){if(m.isAsyncFunction(e))return e(...arguments).then(()=>{t.trigger()}).catch(e=>{throw e});e(...arguments),t.trigger()};return n.$observer=t,n},v.init=function(e){const t={};for(const n in e){const r=e[n];m.isJson(r)?t[n]=v.init(r):m.isArray(r)?t[n]=v.array(r):t[n]=v(r)}const n=function(){};return new Proxy(t,{get:(e,r)=>"__isProxy__"===r||("$value"===r?function(){const e={};for(const n in t){const r=t[n];m.isObservable(r)?e[n]=r.val():m.isProxy(r)?e[n]=r.$value:e[n]=r}return e}():"$clone"===r?n:void 0!==e[r]?e[r]:void 0),set(e,t,n){void 0!==e[t]&&e[t].set(n)}})},v.value=function(e){if(m.isObservable(e))return e.val();if(m.isProxy(e))return e.$value;if(m.isArray(e)){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(v.value(r))}return t}return e},v.update=function(e,t){for(const n in t){const r=e[n],o=t[n];if(m.isObservable(r)){if(m.isArray(o)){v.update(r,o);continue}r.set(o)}else m.isProxy(r)?v.update(r,o):e[n]=o}},v.object=v.init,v.json=v.init,v.computed=function(e,t=[]){const n=new u(e()),r=()=>n.set(e());if(a.emit("CreateObservableComputed",n,t),m.isFunction(t)){if(!m.isObservable(t.$observer))throw new s("Observable.computed : dependencies must be valid batch function");return t.$observer.subscribe(r),n}return t.forEach(e=>e.subscribe(r)),n};const D=function(){const e=new Map;return{use(t){const{observer:n,subscribers:r}=e.get(t),o=v(n.val()),s=n.subscribe(e=>o.set(e)),i=o.subscribe(e=>n.set(e));return o.destroy=()=>{s(),i(),o.cleanup()},r.add(o),o},follow(e){return this.use(e)},create(t,n){const r=v(n);return e.set(t,{observer:r,subscribers:new Set}),r},get(t){const n=e.get(t);return n?n.observer:null},getWithSubscribers:t=>e.get(t),delete(t){const n=e.get(t);n&&(n.observer.cleanup(),n.subscribers.forEach(e=>e.destroy()),n.observer.clear())}}}();const T=function(e,t,n=null){if(!m.isObservable(e))return r.warn("ShowIf","ShowIf : condition must be an Observable / "+n,e);const o=new b("Show if : "+(n||""));let s=null;const i=()=>s||(s=E.getChild(t),s);return e.val()&&o.appendChild(i()),e.subscribe(e=>{e?o.appendChild(i()):o.remove()}),o},P=function(e,t,n=!0){if(!m.isObservable(e))throw new s("Toggle : condition must be an Observable");const r=new b,o=new Map,i=function(e){if(n&&o.has(e))return o.get(e);let r=t[e];return r?(r=E.getChild(r),n&&o.set(e,r),r):null},a=e.val(),u=i(a);return u&&r.appendChild(u),e.subscribe(e=>{const t=i(e);r.remove(),t&&r.appendChild(t)}),r},R=function(e,t,n){if(!m.isObservable(e))throw new s("Toggle : condition must be an Observable");return P(e,{true:t,false:n})},L=A("div"),N=A("span"),B=A("label"),M=A("p"),q=M,j=A("strong"),_=A("h1"),V=A("h2"),H=A("h3"),z=A("h4"),W=A("h5"),U=A("h6"),J=A("br"),K=A("a"),Q=A("pre"),Z=A("code"),G=A("blockquote"),X=A("hr"),Y=A("em"),ee=A("small"),te=A("mark"),ne=A("del"),re=A("ins"),oe=A("sub"),se=A("sup"),ie=A("abbr"),ae=A("cite"),ue=A("q"),le=A("dl"),ce=A("dt"),he=A("dd"),de=A("form",function(e){return e.submit=function(t){return"function"==typeof t?(e.onSubmit(e=>{e.preventDefault(),t(e)}),e):(this.setAttribute("action",t),e)},e.multipartFormData=function(){return this.setAttribute("enctype","multipart/form-data"),e},e.post=function(t){return this.setAttribute("method","post"),this.setAttribute("action",t),e},e.get=function(e){this.setAttribute("method","get"),this.setAttribute("action",e)},e}),pe=A("input"),fe=A("textarea"),me=fe,be=A("select"),ge=A("fieldset"),ve=A("option"),ye=A("legend"),we=A("datalist"),$e=A("output"),Ce=A("progress"),Oe=A("meter"),Se=A("button"),Ee=A("main"),Ae=A("section"),ke=A("article"),Ie=A("aside"),xe=A("nav"),Fe=A("figure"),De=A("figcaption"),Te=A("header"),Pe=A("footer"),Re=A("img"),Le=function(e,t){return Re({src:e,...t})},Ne=A("details"),Be=A("summary"),Me=A("dialog"),qe=A("menu"),je=A("ol"),_e=A("ul"),Ve=A("li"),He=Ve,ze=je,We=_e,Ue=A("audio"),Je=A("video"),Ke=A("source"),Qe=A("track"),Ze=A("canvas"),Ge=A("svg"),Xe=A("time"),Ye=A("data"),et=A("address"),tt=A("kbd"),nt=A("samp"),rt=A("var"),ot=A("wbr"),st=A("caption"),it=A("table"),at=A("thead"),ut=A("tfoot"),lt=A("tbody"),ct=A("tr"),ht=ct,dt=A("th"),pt=dt,ft=dt,mt=A("td"),bt=mt,gt=A("");var vt=Object.freeze({__proto__:null,Abbr:ie,Address:et,Anchor:b,Article:ke,Aside:Ie,AsyncImg:function(e,t,n,r){const o=Le(t||e,n),i=new Image;return i.onload=()=>{m.isFunction(r)&&r(null,o),o.src=e},i.onerror=()=>{m.isFunction(r)&&r(new s("Image not found"))},m.isObservable(e)&&e.subscribe(e=>{i.src=e}),i.src=e,o},Audio:Ue,BaseImage:Re,Blockquote:G,Br:J,Button:Se,Canvas:Ze,Caption:st,Checkbox:e=>pe({type:"checkbox",...e}),Cite:ae,Code:Z,ColorInput:e=>pe({type:"color",...e}),Data:Ye,Datalist:we,DateInput:e=>pe({type:"date",...e}),DateTimeInput:e=>pe({type:"datetime-local",...e}),Dd:he,Del:ne,Details:Ne,Dialog:Me,Div:L,Dl:le,Dt:ce,Em:Y,EmailInput:e=>pe({type:"email",...e}),FieldSet:ge,FigCaption:De,Figure:Fe,FileInput:e=>pe({type:"file",...e}),Footer:Pe,ForEach:function(e,t,n){const o=new b("ForEach"),s=o.endElement();o.startElement();let i=new Map,a=null;const u=new Set,l=e=>{for(const[t,n]of i.entries()){if(u.has(t))continue;const r=n.child?.deref();e&&r&&e.removeChild(r),n.indexObserver?.cleanup(),n.child=null,n.indexObserver=null,i.delete(n.keyId),a&&a.delete(n.keyId)}},h=(e,o)=>{const s=c(e,o,n);if(i.has(s)){const e=i.get(s);if(e.indexObserver?.set(o),e.isNew=!1,e.child?.deref())return s;i.delete(s)}try{const n=t.length>=2?v(o):null;let r=E.getChild(t(e,n));i.set(s,{keyId:s,isNew:!0,child:new WeakRef(r),indexObserver:n})}catch(e){throw r.error("ForEach",`Error creating element for key ${s}`,e),e}return s},d=()=>{const t=s.parentNode;if(!t)return;const n=m.isObservable(e)?e.val():e;if(u.clear(),Array.isArray(n))for(let e=0,t=n.length;e<t;e++){const t=h(n[e],e);u.add(t)}else for(const e in n){const t=h(n[e],e);u.add(t)}if(0===u.size)return o.removeChildren(),l(),void a?.clear();l(t),a&&0!==a.size?(()=>{let e=document.createDocumentFragment();const t=Array.from(u);Array.from(a);for(const n in t){const r=t[n],o=i.get(r);if(!o)continue;const s=o.child.deref();s&&e.appendChild(s)}o.replaceContent(e)})():(e=>{const t=document.createDocumentFragment();for(const e of u){const n=i.get(e);if(!n)continue;const r=n.child?.deref();r&&t.appendChild(r)}e.insertBefore(t,s)})(t),a?.clear(),a=new Set([...u])};return d(),m.isObservable(e)&&e.subscribe(d),o},ForEachArray:function(e,t,n,o={}){const s=new b("ForEach Array"),i=s.endElement(),a=s.startElement();let u=new Map,l=0;const h=t.length>=2,d=new WeakMap,p=()=>{s.removeChildren(),w(),l=0},f=(e,t)=>d.has(e)?d.get(e):c(e,t,n),g=e=>C(f(e)),y=(e,t=!0)=>{if(!e)return;const n=e.child;e.indexObserver?.deref()?.cleanup(),e.child=null,e.indexObserver=null,t&&(n?.remove(),u.delete(e.keyId))},w=()=>{for(const[e,t]of u.entries())y(t,!1);u.clear()},$=(e,n)=>{const o=f(e,n);if(u.has(o)){const e=u.get(o);e.indexObserver?.deref()?.set(n);const t=e.child;if(t)return t;u.delete(o)}try{const r=h?v(n):null;let s=E.getChild(t(e,r));return u.set(o,{keyId:o,child:s,indexObserver:r?new WeakRef(r):null}),d.set(e,o),s}catch(e){throw r.error("ForEach",`Error creating element for key ${o}`,e),e}},C=function(e){const t=u.get(e);if(!t)return null;const n=t.child;return n||(y(t,!1),null)},O=function(e,t){const n=u.get(e);if(!n)return null;const r=n.child;if(!r)return null;t?t.appendChild(r):r.remove()},S={toFragment(e,t=0){const n=document.createDocumentFragment();for(let t=0,r=e.length;t<r;t++)n.append($(e[t],l)),l++;return n},add(e,t=0){const n=S.toFragment(e);setTimeout(()=>{s.appendElement(n)},t)},replace(e){p(),S.add(e)},reOrder(e){let t=null;const n=document.createDocumentFragment();for(const r of e)t=g(r),t&&n.appendChild(t);t=null,s.appendElement(n,i)},removeOne(e,t){let n=g(e);n&&((e,t=!0)=>{y(u.get(e),t)})(f(e,t),!0),n=null},clear:p,merge(e){S.add(e,0)},push(e){let t=0;o.pushDelay&&(t=o.pushDelay(e)??0),S.add(e,t)},populate([e,t,n]){const r=document.createDocumentFragment();for(let o=0;o<t;o++){const t=n(o);e.push(t),r.append($(t,o)),l++}s.appendChild(r),r.replaceChildren()},unshift(e){s.insertBefore(S.toFragment(e),a.nextSibling)},splice(e,t){const[n,r,...o]=e;let a=null;const u=document.createDocumentFragment();if(t.length>0){let e=f(t[0],n);if(1===t.length)O(e,u);else if(t.length>1){const r=C(e);a=r?.previousSibling;for(let e=0;e<t.length;e++){const r=f(t[e],n+e);O(r,u)}}}else a=i;u.replaceChildren(),o&&o.length&&a&&s.insertBefore(S.toFragment(o),a.nextSibling)},reverse(e,t){S.reOrder(t)},sort(e,t){S.reOrder(t)},remove(e,t){S.removeOne(t)},pop(e,t){S.removeOne(t)},shift(e,t){S.removeOne(t)},swap(e,t){const n=i.parentNode;let r=g(t[0]),o=g(t[1]);if(!r||!o)return;const s=o.nextSibling;n.insertBefore(o,r),n.insertBefore(r,s),r=null,o=null}},A=(e,t,n)=>{if("clear"!==n.action&&e.length){if(n?.action)S[n.action]&&S[n.action](n.args,n.result);else{if(0===l)return void S.add(e);S.replace(e)}((e,t=0)=>{if(!h)return;let n=t;for(let r=t,o=e?.length;r<o;r++){const t=u.get(f(e[r],r));t&&(t.indexObserver?.deref()?.set(n),n++)}})(e,0)}else{if(0===l)return;p()}};return A(e.val(),0,{action:null}),m.isObservable(e)&&e.subscribe(A),s},Form:de,Fragment:gt,H1:_,H2:V,H3:H,H4:z,H5:W,H6:U,Header:Te,HiddenInput:e=>pe({type:"hidden",...e}),HideIf:function(e,t,n){const r=v(!e.val());return e.subscribe(e=>r.set(!e)),T(r,t,n)},HideIfNot:function(e,t,n){return T(e,t,n)},Hr:X,Img:Le,Input:pe,Ins:re,Kbd:tt,Label:B,LazyImg:function(e,t){return Le(e,{...t,loading:"lazy"})},Legend:ye,Li:He,Link:K,ListItem:Ve,Main:Ee,Mark:te,Match:P,Menu:qe,Meter:Oe,MonthInput:e=>pe({type:"month",...e}),NativeDocumentFragment:b,Nav:xe,NumberInput:e=>pe({type:"number",...e}),Ol:ze,Option:ve,OrderedList:je,Output:$e,P:M,Paragraph:q,PasswordInput:e=>pe({type:"password",...e}),Pre:Q,Progress:Ce,Quote:ue,Radio:e=>pe({type:"radio",...e}),RangeInput:e=>pe({type:"range",...e}),ReadonlyInput:e=>pe({readonly:!0,...e}),Samp:nt,SearchInput:e=>pe({type:"search",...e}),Section:Ae,Select:be,ShowIf:T,SimpleButton:(e,t)=>Se(e,{type:"button",...t}),Small:ee,Source:Ke,Span:N,Strong:j,Sub:oe,SubmitButton:(e,t)=>Se(e,{type:"submit",...t}),Summary:Be,Sup:se,Svg:Ge,Switch:R,TBody:lt,TBodyCell:bt,TFoot:ut,TFootCell:ft,THead:at,THeadCell:pt,TRow:ht,Table:it,Td:mt,TelInput:e=>pe({type:"tel",...e}),TextArea:fe,TextInput:me,Th:dt,Time:Xe,TimeInput:e=>pe({type:"time",...e}),Tr:ct,Track:Qe,Ul:We,UnorderedList:_e,UrlInput:e=>pe({type:"url",...e}),Var:rt,Video:Je,Wbr:ot,WeekInput:e=>pe({type:"week",...e}),When:function(e){if(!m.isObservable(e))throw new s("When : condition must be an Observable");let t=null,n=null;return{show(e){return t=e,this},otherwise:r=>(n=r,R(e,t,n))}}});const yt={};function wt(e,t,n={}){e="/"+h(e,"/");let r=null,o=n.name||null;const s=n.middlewares||[],i=n.shouldRebuild||!1,a=n.with||{},u={},l=[],c=e=>{if(!e)return null;const[t,n]=e.split(":");let r=a[t];return!r&&n&&(r=yt[n]),r||(r="[^/]+"),r=r.replace("(","(?:"),{name:t,pattern:`(${r})`}},d=()=>{if(r)return r;const t=e.replace(/\{(.*?)}/gi,(e,t)=>{const n=c(t);return n&&n.pattern?(u[n.name]=n.pattern,l.push(n.name),n.pattern):e});return r=new RegExp("^"+t+"$"),r};this.name=()=>o,this.component=()=>t,this.middlewares=()=>s,this.shouldRebuild=()=>i,this.path=()=>e,this.match=function(e){e="/"+h(e,"/");if(!d().exec(e))return!1;const t={};return d().exec(e).forEach((e,n)=>{if(n<1)return;const r=l[n-1];t[r]=e}),t},this.url=function(t){const n=e.replace(/\{(.*?)}/gi,(e,n)=>{const r=c(n);if(t.params&&t.params[r.name])return t.params[r.name];throw new Error(`Missing parameter '${r.name}'`)}),r="object"==typeof t.query?new URLSearchParams(t.query).toString():null;return(t.basePath?t.basePath:"")+(r?`${n}?${r}`:n)}}class $t extends Error{constructor(e,t){super(e),this.context=t}}const Ct=(e,t)=>{const n=[];return e.forEach(e=>{n.push(h(e.suffix,"/"))}),n.push(h(t,"/")),n.join("/")},Ot=(e,t)=>{const n=[];return e.forEach(e=>{e.options.middlewares&&n.push(...e.options.middlewares)}),t&&n.push(...t),n},St=(e,t)=>{const n=[];return e.forEach(e=>{e.options?.name&&n.push(e.options.name)}),t&&n.push(t),n.join(".")};function Et(){const e=[];let t=0;const n=n=>{const o=t+n;if(!e[o])return;t=o;const{route:s,params:i,query:a,path:u}=e[o];r(u)},r=e=>{window.location.replace(`${window.location.pathname}${window.location.search}#${e}`)},o=()=>window.location.hash.slice(1);this.push=function(n){const{route:s,params:i,query:a,path:u}=this.resolve(n);u!==o()&&(e.splice(t+1),e.push({route:s,params:i,query:a,path:u}),t++,r(u))},this.replace=function(n){const{route:r,params:s,query:i,path:a}=this.resolve(n);a!==o()&&(e[t]={route:r,params:s,query:i,path:a})},this.forward=function(){return t<e.length-1&&n(1)},this.back=function(){return t>0&&n(-1)},this.init=function(n){window.addEventListener("hashchange",()=>{const{route:e,params:t,query:n,path:r}=this.resolve(o());this.handleRouteChange(e,t,n,r)});const{route:r,params:s,query:i,path:a}=this.resolve(n||o());e.push({route:r,params:s,query:i,path:a}),t=0,this.handleRouteChange(r,s,i,a)}}function At(){this.push=function(e){try{const{route:t,path:n,params:r,query:o}=this.resolve(e);if(window.history.state&&window.history.state.path===n)return;window.history.pushState({name:t.name(),params:r,path:n},t.name()||n,n),this.handleRouteChange(t,r,o,n)}catch(e){r.error("HistoryRouter","Error in pushState",e)}},this.replace=function(e){const{route:t,path:n,params:o}=this.resolve(e);try{window.history.replaceState({name:t.name(),params:o,path:n},t.name()||n,n),this.handleRouteChange(t,o,{},n)}catch(e){r.error("HistoryRouter","Error in replaceState",e)}},this.forward=function(){window.history.forward()},this.back=function(){window.history.back()},this.init=function(e){window.addEventListener("popstate",e=>{try{if(!e.state||!e.state.path)return;const t=e.state.path,{route:n,params:r,query:o,path:s}=this.resolve(t);if(!n)return;this.handleRouteChange(n,r,o,s)}catch(e){r.error("HistoryRouter","Error in popstate event",e)}});const{route:t,params:n,query:o,path:s}=this.resolve(e||window.location.pathname+window.location.search);this.handleRouteChange(t,n,o,s)}}function kt(){const e=[];let t=0;const n=n=>{const r=t+n;if(!e[r])return;t=r;const{route:o,params:s,query:i,path:a}=e[r];this.handleRouteChange(o,s,i,a)};this.push=function(n){const{route:r,params:o,query:s,path:i}=this.resolve(n);e[t]&&e[t].path===i||(e.splice(t+1),e.push({route:r,params:o,query:s,path:i}),t++,this.handleRouteChange(r,o,s,i))},this.replace=function(n){const{route:r,params:o,query:s,path:i}=this.resolve(n);e[t]={route:r,params:o,query:s,path:i},this.handleRouteChange(r,o,s,i)},this.forward=function(){return t<e.length-1&&n(1)},this.back=function(){return t>0&&n(-1)},this.init=function(n){const r=n||window.location.pathname+window.location.search,{route:o,params:s,query:i,path:a}=this.resolve(r);e.push({route:o,params:s,query:i,path:a}),t=0,this.handleRouteChange(o,s,i,a)}}const It="default";function xt(e={}){const t=[],n={},o=[],s=[],i={route:null,params:null,query:null,path:null,hash:null};if("hash"===e.mode)Et.apply(this,[]);else if("history"===e.mode)At.apply(this,[]);else{if("memory"!==e.mode)throw new $t("Invalid router mode "+e.mode);kt.apply(this,[])}const a=function(e,t){for(const n of s)try{n(e),t&&t(e)}catch(e){r.warn("Route Listener","Error in listener:",e)}};this.routes=()=>[...t],this.currentState=()=>({...i}),this.add=function(e,r,s){const i=new wt(Ct(o,e),r,{...s,middlewares:Ot(o,s?.middlewares||[]),name:s?.name?St(o,s.name):null});return t.push(i),i.name()&&(n[i.name()]=i),this},this.group=function(e,t,n){if(!m.isFunction(n))throw new $t("Callback must be a function");return o.push({suffix:e,options:t}),n(),o.pop(),this},this.generateUrl=function(e,t={},r={}){const o=n[e];if(!o)throw new $t(`Route not found for name: ${e}`);return o.url({params:t,query:r})},this.resolve=function(e){if(m.isJson(e)){const t=n[e.name];if(!t)throw new $t(`Route not found for name: ${e.name}`);return{route:t,params:e.params,query:e.query,path:t.url({...e})}}const[r,o]=e.split("?"),s="/"+h(r,"/");let i,a=null;for(const e of t)if(i=e.match(s),i){a=e;break}if(!a)throw new $t(`Route not found for url: ${r}`);const u={};if(o){const e=new URLSearchParams(o).entries();for(const[t,n]of e)u[t]=n}return{route:a,params:i,query:u,path:e}},this.subscribe=function(e){if(!m.isFunction(e))throw new $t("Listener must be a function");return s.push(e),()=>{s.splice(s.indexOf(e),1)}},this.handleRouteChange=function(e,t,n,r){i.route=e,i.params=t,i.query=n,i.path=r;const o=[...e.middlewares(),a];let s=0;const u={...i},l=e=>{if(s++,!(s>=o.length))return o[s](e||u,l)};return o[s](u,l)}}function Ft(e,t){const{to:n,href:r,...o}=e,s=n||r;if(m.isString(s)){const e=xt.get();return K({...o,href:s},t).nd.onPreventClick(()=>{e.push(s)})}const i=s.router||It,a=xt.get(i);if(!a)throw new $t('Router not found "'+i+'" for link "'+s.name+'"');const u=a.generateUrl(s.name,s.params,s.query);return K({...o,href:u},t).nd.onPreventClick(()=>{a.push(u)})}xt.routers={},xt.create=function(t,n){if(!m.isFunction(n))throw r.error("Router","Callback must be a function",e),new $t("Callback must be a function");const o=new xt(t);return xt.routers[t.name||It]=o,n(o),o.init(t.entry),o.mount=function(e){if(m.isString(e)){const t=document.querySelector(e);if(!t)throw new $t(`Container not found for selector: ${e}`);e=t}else if(!m.isElement(e))throw new $t("Container must be a string or an Element");return function(e,t){const n=new Map,r=function(e){t.innerHTML="",t.appendChild(e)},o=function(e){if(!e.route)return;const{route:t,params:o,query:s,path:i}=e;if(n.has(i)){const e=n.get(i);return void r(e)}const a=t.component()({params:o,query:s});n.set(i,a),r(a)};return e.subscribe(o),o(e.currentState()),t}(o,e)},o},xt.get=function(e){const t=xt.routers[e||It];if(!t)throw new $t(`Router not found for name: ${e}`);return t},xt.push=function(e,t=null){return xt.get(t).push(e)},xt.replace=function(e,t=null){return xt.get(t).replace(e)},xt.forward=function(e=null){return xt.get(e).forward()},xt.back=function(e=null){return xt.get(e).back()},Ft.blank=function(e,t){return K({...e,target:"_blank"},t)};var Dt=Object.freeze({__proto__:null,Link:Ft,RouteParamPatterns:yt,Router:xt});return t.ArgTypes=I,t.ElementCreator=E,t.HtmlElementWrapper=A,t.NDElement=f,t.Observable=v,t.Store=D,t.classPropertyAccumulator=function(e=[]){let t=m.isString(e)?e.split(" ").filter(Boolean):e;const n=m.isArray(t);return{add(e,r=!0){n?t.push(e):t[e]=r},value:()=>n?t.join(" "):{...t}}},t.cssPropertyAccumulator=function(e={}){let t=m.isString(e)?e.split(";").filter(Boolean):e;const n=m.isArray(t);return{add(e,r){n?t.push(e+" :  "+r):t[e]=r},value:()=>n?t.join(";").concat(";"):{...t}}},t.elements=vt,t.normalizeComponentArgs=function(e,t){if(!m.isJson(t)){const n=e;e=t,t=n}return{props:e,children:t}},t.router=Dt,t.withValidation=x,t}({});
